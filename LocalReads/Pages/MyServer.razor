@page "/myserver"
@inject IHttpRequest HttpRequest
@inject NavigationManager Navigation

<MudGrid Class="px-4" Style="min-height: 600px;">
    <!-- Left: User List (40%) -->
    <MudItem xs="12" md="5" lg="4">
        <MudPaper Class="pa-6" Style="height:100%; overflow-y:auto; min-height:500px; background: white;">
            <MudText Typo="Typo.h5" Class="mb-4">Server Members</MudText>
            <MudList T="UserResponse" Dense="false">
                @if (Users.Count == 0)
                {
                    <MudText Typo="Typo.body1" Color="Color.Secondary">No users found.</MudText>
                }
                else
                {
                    @foreach (var user in Users)
                    {
                        <MudListItem Class="mb-3 rounded-lg user-card" Style="cursor:pointer;" @onclick="() => GoToUser(user.Id)">
                            <MudPaper Class="d-flex align-items-center pa-3"
                                      Elevation="3"
                                      Color="Color.Primary"
                                      Outlined="true"
                                      Style="width:100%; background: var(--mud-palette-primary-light); transition: box-shadow 0.2s, background 0.2s;">
                                <MudAvatar Size="Size.Large" Color="Color.Tertiary" Class="me-3">
                                    @user.Name?.FirstOrDefault()
                                </MudAvatar>
                                <MudElement Class="flex-grow-1">
                                    <MudText Typo="Typo.subtitle1" Class="fw-bold" Style="color: var(--mud-palette-primary-dark);">@user.Name</MudText>
                                    <MudText Typo="Typo.body2" Color="Color.Secondary">@user.UserName</MudText>
                                    <MudText Typo="Typo.body2" Color="Color.Secondary">@user.Location</MudText>
                                    <MudText Typo="Typo.body2" Color="Color.Info">@user.FavoriteBooksCount books</MudText>
                                    <MudText Typo="Typo.caption" Color="Color.Primary" Class="mt-1">
                                        Currently reading: <b>@user.CurrentlyReading</b>
                                    </MudText>
                                </MudElement>
                            </MudPaper>
                        </MudListItem>
                    }
                }
            </MudList>
        </MudPaper>
    </MudItem>

    <!-- Right: Placeholder for future content (60%) -->
    <MudItem xs="12" md="7" lg="8">
        <MudPaper Class="pa-6 d-flex flex-column align-items-center justify-center" Style="height:100%; min-height:500px;">
            <MudText Typo="Typo.h6" Color="Color.Tertiary" Class="mb-2">
                Future content area
            </MudText>
            <MudText Typo="Typo.body2" Color="Color.Secondary" Align="Align.Center">
                This space is reserved for server statistics, most read books, or other features.
            </MudText>
        </MudPaper>
    </MudItem>
</MudGrid>

<style>
    .user-card:hover > .mud-paper {
        box-shadow: 0 4px 24px 0 rgba(25, 118, 210, 0.15);
        background: var(--mud-palette-primary);
        color: var(--mud-palette-primary-contrast);
    }
    .user-card > .mud-paper {
        transition: box-shadow 0.2s, background 0.2s, color 0.2s;
    }
</style>

@code {
    private List<UserResponse> Users = new List<UserResponse>();

    protected override async Task OnInitializedAsync()
    {
        Users = (await HttpRequest.Get<List<UserResponse>>($"/users")).Content;
    }

    private void GoToUser(int id)
    {
        Navigation.NavigateTo($"/profile/{id}");
    }
}
