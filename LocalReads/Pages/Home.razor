@page "/"
@using LocalReads.DTO
@using LocalReads.Services
@using LocalReads.Components
@using LocalReads.State
@using MudBlazor
@inject IOpenLibraryService OpenLibraryService
@inject AppState AppState

<MudText>Resultados de: @AppState.SearchResults.TermSearch</MudText>
<MudDivider />
<MudContainer class="book-grid">
    @foreach(BookDto book in AppState.SearchResults.Books)
    {
        <BookCard Book="@book" />
    }
</MudContainer>

@code
{
    protected override async Task OnInitializedAsync()
    {
        AppState.SearchResults.OnChange += StateHasChanged;

        var books = (await OpenLibraryService.GetRandomBooks())
            .Select(BookDto.FromBook);
        AppState.SearchResults.SetSearchResults(books.ToList());
    }
    
    public void Dispose()
    {
        AppState.SearchResults.OnChange -= StateHasChanged;
    }
}
