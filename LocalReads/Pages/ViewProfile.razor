@page "/profile/{id}"
@inject IHttpRequest HttpRequest
@inject AppState State

<MudContainer MaxWidth="MaxWidth.Medium" Class="my-8 d-flex justify-center">
    <MudPaper Elevation="4" Class="pa-6 w-100" Style="border-radius: 18px;">
        <MudGrid>
            <MudItem xs="12" md="4" Class="d-flex flex-column align-items-center justify-center">
                <MudAvatar Size="Size.Large"
                           Class="mb-3"
                           Src="staticfiles/userprofile.png"
                           Alt="User profile image"
                           Style="width: 180px; height: 180px; box-shadow: 0 4px 24px 0 rgba(25, 118, 210, 0.10);" />
                <MudDivider Class="mb-3" />
                <MudStack Spacing="1" AlignItems="AlignItems.Center">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">
                        <MudIcon Icon="@Icons.Material.Filled.Star" Color="Color.Warning" Class="me-1" />
                        @User.AverageRating average
                    </MudText>
                    <MudText Typo="Typo.subtitle2" Color="Color.Info">
                        <MudIcon Icon="@Icons.Material.Filled.Book" Color="Color.Info" Class="me-1" />
                        @User.FavoriteBooksCount ratings
                    </MudText>
                </MudStack>
                @if (State.UserState.User?.Id == User.Id)
                {
                    <MudButton Variant="Variant.Outlined" Color="Color.Primary" Href="/profile/edit" Class="mt-4" StartIcon="@Icons.Material.Filled.Edit">
                        Edit Profile
                    </MudButton>
                }
            </MudItem>
            <MudItem xs="12" md="8">
                <MudText Typo="Typo.h4" Class="mb-2">@GetUserName()</MudText>
                <MudDivider Class="mb-4" />
                <MudStack Spacing="2">
                    <MudStack Direction="Row" Spacing="2" AlignItems="AlignItems.Center">
                        <MudText Style="width: 140px; font-weight: bold">Location:</MudText>
                        <MudText>@User.Location</MudText>
                    </MudStack>
                    <MudStack Direction="Row" Spacing="2" AlignItems="AlignItems.Center">
                        <MudText Style="width: 140px; font-weight: bold">Member Since:</MudText>
                        <MudText>@User.MemberSince.Date.ToString("MM/dd/yyyy")</MudText>
                    </MudStack>
                    <MudStack Direction="Row" Spacing="2" AlignItems="AlignItems.Start">
                        <MudText Style="width: 140px; font-weight: bold">About me:</MudText>
                        <MudText>@User.PersonalIntroduction</MudText>
                    </MudStack>
                </MudStack>
            </MudItem>
        </MudGrid>
    </MudPaper>
</MudContainer>

@code {
    [Parameter]
    public string id { get; set; }
    private UserResponse User = new();
    
    protected override async Task OnInitializedAsync()
    {
        User = (await HttpRequest.Get<UserResponse>($"/user/{id}")).Content;
    }

    private string GetUserName()
    {
        return string.IsNullOrEmpty(User.Name) 
            ? User.UserName : $"{User.Name} ({User.UserName})";
    }

}
